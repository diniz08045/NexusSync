{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-12 mb-4">
        <div class="widget">
            <h4 class="widget-title">
                <i data-feather="settings" class="widget-icon"></i>
                Account Settings
            </h4>
            <div class="row">
                <!-- Settings Navigation -->
                <div class="col-md-3 mb-4 mb-md-0">
                    <div class="list-group">
                        <a href="#profile" class="list-group-item list-group-item-action active" data-bs-toggle="tab">
                            <i data-feather="user" class="feather-sm me-2"></i>
                            Profile Information
                        </a>
                        <a href="#security" class="list-group-item list-group-item-action" data-bs-toggle="tab">
                            <i data-feather="shield" class="feather-sm me-2"></i>
                            Security Settings
                        </a>
                        <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="tab">
                            <i data-feather="bell" class="feather-sm me-2"></i>
                            Notification Preferences
                        </a>
                    </div>
                </div>
                
                <!-- Settings Content -->
                <div class="col-md-9">
                    <div class="tab-content">
                        <!-- Profile Tab -->
                        <div class="tab-pane fade show active" id="profile">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Profile Information</h5>
                                </div>
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('user.edit_profile') }}" class="needs-validation" novalidate>
                                        {{ form.hidden_tag() }}
                                        <div class="mb-3">
                                            <label for="username" class="form-label">Username</label>
                                            {{ form.username(class="form-control", placeholder="Username") }}
                                            {% for error in form.username.errors %}
                                                <div class="invalid-feedback d-block">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                        <div class="mb-3">
                                            <label for="email" class="form-label">Email Address</label>
                                            {{ form.email(class="form-control", placeholder="Email Address") }}
                                            {% for error in form.email.errors %}
                                                <div class="invalid-feedback d-block">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                        <div class="mb-3">
                                            <label for="first_name" class="form-label">First Name</label>
                                            {{ form.first_name(class="form-control", placeholder="First Name") }}
                                            {% for error in form.first_name.errors %}
                                                <div class="invalid-feedback d-block">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                        <div class="mb-3">
                                            <label for="last_name" class="form-label">Last Name</label>
                                            {{ form.last_name(class="form-control", placeholder="Last Name") }}
                                            {% for error in form.last_name.errors %}
                                                <div class="invalid-feedback d-block">{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                        <div class="d-grid gap-2">
                                            {{ form.submit(class="btn btn-primary") }}
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Tab -->
                        <div class="tab-pane fade" id="security">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Account Verification</h5>
                                </div>
                                <div class="card-body">
                                    {% if current_user.is_email_confirmed %}
                                        <div class="alert alert-success">
                                            <i data-feather="check-circle" class="feather-sm me-2"></i>
                                            Your email address has been verified.
                                        </div>
                                    {% else %}
                                        <div class="alert alert-warning">
                                            <i data-feather="alert-triangle" class="feather-sm me-2"></i>
                                            Your email address has not been verified.
                                        </div>
                                        <p class="mb-3">Verifying your email address helps secure your account and enables you to recover your account if you forget your password.</p>
                                        <form action="{{ url_for('user.resend_confirmation') }}" method="POST">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                            <button type="submit" class="btn btn-primary">
                                                <i data-feather="mail" class="feather-sm me-2"></i>
                                                Resend Verification Email
                                            </button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0">Two-Factor Authentication</h5>
                                </div>
                                <div class="card-body">
                                    {% if current_user.two_factor_enabled %}
                                        <div class="alert alert-success">
                                            <i data-feather="check-circle" class="feather-sm me-2"></i>
                                            Two-factor authentication is enabled for your account.
                                        </div>
                                        <p>Two-factor authentication adds an extra layer of security to your account by requiring a verification code in addition to your password when you log in.</p>
                                        <form action="{{ url_for('user.disable_two_factor') }}" method="POST">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                            <button type="submit" class="btn btn-danger" data-confirm="Are you sure you want to disable two-factor authentication? This will decrease your account security.">
                                                <i data-feather="shield-off" class="feather-sm me-2"></i>
                                                Disable Two-Factor Authentication
                                            </button>
                                        </form>
                                    {% else %}
                                        <div class="alert alert-warning">
                                            <i data-feather="alert-triangle" class="feather-sm me-2"></i>
                                            Two-factor authentication is not enabled for your account.
                                        </div>
                                        <p>Two-factor authentication adds an extra layer of security to your account by requiring a verification code in addition to your password when you log in.</p>
                                        <a href="{{ url_for('user.setup_two_factor') }}" class="btn btn-primary">
                                            <i data-feather="shield" class="feather-sm me-2"></i>
                                            Enable Two-Factor Authentication
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Password Settings</h5>
                                </div>
                                <div class="card-body">
                                    <p>It's a good idea to change your password regularly and to use a strong, unique password that you don't use for other accounts.</p>
                                    <a href="{{ url_for('user.change_password') }}" class="btn btn-primary">
                                        <i data-feather="key" class="feather-sm me-2"></i>
                                        Change Password
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notifications Tab -->
                        <div class="tab-pane fade" id="notifications">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="mb-0">Notification Preferences</h5>
                                </div>
                                <div class="card-body">
                                    <p class="text-secondary mb-4">Control how and when you receive notifications from the system.</p>
                                    
                                    <h6>Email Notifications</h6>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="security_notifications" checked>
                                        <label class="form-check-label" for="security_notifications">
                                            Security Alerts
                                            <small class="text-secondary d-block">
                                                Receive notifications about security events like password changes or login attempts
                                            </small>
                                        </label>
                                    </div>
                                    
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="system_notifications" checked>
                                        <label class="form-check-label" for="system_notifications">
                                            System Announcements
                                            <small class="text-secondary d-block">
                                                Receive notifications about system updates and important announcements
                                            </small>
                                        </label>
                                    </div>
                                    
                                    <hr>
                                    
                                    <h6>Application Notifications</h6>
                                    <div class="form-check form-switch mb-3">
                                        <input class="form-check-input" type="checkbox" id="in_app_notifications" checked>
                                        <label class="form-check-label" for="in_app_notifications">
                                            In-App Notifications
                                            <small class="text-secondary d-block">
                                                Show notifications within the application
                                            </small>
                                        </label>
                                    </div>
                                    
                                    <button class="btn btn-primary">
                                        <i data-feather="save" class="feather-sm me-2"></i>
                                        Save Notification Preferences
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get hash from URL
        let hash = window.location.hash;
        if (hash) {
            // Activate the tab
            document.querySelector('.list-group-item[href="' + hash + '"]').click();
        }
        
        // Update URL hash when tab changes
        document.querySelectorAll('.list-group-item').forEach(tab => {
            tab.addEventListener('click', function() {
                window.location.hash = this.getAttribute('href');
            });
        });
    });
</script>
{% endblock %}